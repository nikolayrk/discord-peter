name: Deploy Helm Chart

on:
  workflow_call:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1

    - name: Deploy
      uses: deliverybot/helm@v1
      with:
        release: discord-peter
        namespace: discord-peter
        chart: app
        token: ${{ github.token }}
        values: |
          image:
            repository=ghcr.io/${{ github.repository }}
            tag=${{ github.sha }}
          secrets:
            discordToken: ${{ secrets.DISCORD_TOKEN }}
            geminiApiKey: ${{ secrets.GEMINI_API_KEY }}
      env:
        KUBECONFIG_FILE: ${{ secrets.KUBECONFIG }}